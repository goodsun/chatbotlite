<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self'; connect-src 'self' https://generativelanguage.googleapis.com https://texttospeech.googleapis.com https://cdn.jsdelivr.net; media-src blob:; img-src 'self' data: https:; font-src 'self';">
<title>ChatBot Lite</title>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js" integrity="sha384-80VlBZnyAwkkqtSfg5NhPyZff6nU4K/qniLBL8Jnm4KDv6jZhLiYtJbhglg/i9ww" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@15/marked.min.js" integrity="sha384-948ahk4ZmxYVYOc+rxN1H2gM1EJ2Duhp7uHtZ4WSLkV4Vtx5MUqnV+l7u9B+jFv+" crossorigin="anonymous"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="header">
  <h1>💬 ChatBot Lite</h1>
  <button class="config-toggle" id="configToggle" aria-expanded="false" aria-controls="configPanel">⚙️ Settings</button>
  <form class="api-group" id="apiForm" action="javascript:void(0)">
    <input type="password" id="apiKey" name="apiKey" placeholder="Gemini API Key" autocomplete="off">
    <button type="button" id="keyVisBtn" title="Show/Hide" aria-label="APIキーを表示/非表示">👁</button>
    <label><input type="checkbox" id="rememberCb"> Remember</label>
  </form>
</div>

<div class="config-panel" id="configPanel">
  <label>System Prompt (この子の性格・知識を定義)</label>
  <textarea id="systemPrompt">あなたは親切で知的なAIアシスタントです。日本語で丁寧にお答えください。</textarea>
  <div class="config-row">
    <label>Model:
      <select id="modelSelect">
        <option value="gemini-2.5-flash">gemini-2.5-flash</option>
        <option value="gemini-2.0-flash">gemini-2.0-flash</option>
        <option value="gemini-1.5-flash">gemini-1.5-flash</option>
        <option value="gemini-1.5-pro">gemini-1.5-pro</option>
      </select>
    </label>
    <label>Title: <input type="text" id="botTitle" value="ChatBot Lite"></label>
    <label class="tts-auto-label"><input type="checkbox" id="ttsAutoCb"> 🔊 自動読み上げ</label>
    <button id="clearMemory" class="btn-danger">🗑 記憶クリア</button>
    <button id="clearHistory" class="btn-secondary">🗑 履歴クリア</button>
  </div>
  <div id="memoryPreview"></div>
</div>

<div class="chat-area" id="chatArea" role="log" aria-live="polite">
  <div class="welcome" id="welcome">
    <img id="welcomeImg" src="images/mephi.jpg" alt="ChatBot">
    <h2>💬 ChatBot Lite</h2>
    <p>HTML1ファイルで動くAIチャットbot。<br>Gemini APIキーを入力して話しかけてください。</p>
    <p class="hint">⚙️ Settings からシステムプロンプトを編集して、<br>好きなキャラクター・専門知識を持たせられます。</p>
  </div>
</div>

<div class="input-area">
  <textarea id="userInput" placeholder="メッセージを入力..." rows="1"></textarea>
  <button id="sendBtn">送信</button>
</div>

<div class="modal-overlay" id="securityModal">
  <div class="modal-box">
    <h3>🔐 セキュリティに関する注意</h3>
    <ul>
      <li>APIキーはブラウザのlocalStorageに保存されます</li>
      <li>ブラウザ拡張機能やXSS攻撃でアクセスされる可能性があります</li>
      <li>機密性の高い用途ではRememberをOFFにしてください</li>
      <li>キーは <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a> でいつでも再生成できます</li>
    </ul>
    <div class="modal-actions">
      <button class="modal-cancel" id="modalCancel">キャンセル</button>
      <button class="modal-confirm" id="modalConfirm">保存する</button>
    </div>
  </div>
</div>

<script type="module" src="app.js"></script>
<img class="mascot-bustup hidden" id="mascotBustup" src="" alt="">
</body>
</html>
